define("apps/integration-aws/app",["require","jquery","lodash","monster","toastr"],function(t){var n=t("jquery"),a=t("lodash"),e=t("monster"),i=t("toastr");return{name:"skeleton",css:["app"],i18n:{"en-US":{customCss:!1},"fr-FR":{customCss:!1}},appFlags:{appData:{storage:{}}},requests:{},subscribe:{},load:function(t){var n=this;n.initApp(function(){t&&t(n)})},initApp:function(t){var n=this;e.pub("auth.initApp",{app:n,callback:t})},render:function(t){var n=this;e.ui.generateAppLayout(n,{menus:[{tabs:[{callback:n.renderListAccounts}]}]})},renderListAccounts:function(t){var a=this,e=t||{},i=e.container||n("#integration_aws_app_container .app-content-wrapper");a.getAWSAccounts(function(t){var e=a.formatAWSData(t),o=n(a.getTemplate({name:"layout",data:e}));a.bindListingView(o),i.fadeOut(function(){n(this).empty().append(o).fadeIn()})})},renderEditConfiguration:function(t){var a=this,i=n("#integration_aws_app_container .app-content-wrapper");a.getConfigurationData(t,function(o){var s=a.formatEditConfigurationData(o),l=n(e.template(a,"edit-configuration",s));a.bindEditConfiguration(l,o,t),i.fadeOut(function(){n(this).empty().append(l).fadeIn()})})},bindEditConfiguration:function(t,n,a){var o=this,s=t.find("#configuration_form");e.ui.protectField(t.find("#settings_key"),t),e.ui.protectField(t.find("#settings_secret"),t),e.ui.validate(s),t.find("#cancel").on("click",function(t){t.preventDefault(),o.renderListAccounts()}),t.find("#save").on("click",function(t){if(t.preventDefault(),e.ui.valid(s)){var l=e.ui.getFormData("configuration_form"),c=o.configurationCleanFormData(l,n);o.saveAWSConfiguration(a,c,function(t){i.success(e.template(o,"!"+o.i18n.active().integrationAWS.edition.successUpdate,{variable:t.name})),o.renderListAccounts()})}})},configurationCleanFormData:function(t,a){var e=n.extend(!0,a,t);return""===e.settings.host&&delete e.settings.host,""===e.settings.key&&delete e.settings.key,""===e.settings.secret&&delete e.settings.secret,""===e.settings.bucket&&delete e.settings.bucket,delete e.extra,e},formatEditConfigurationData:function(t){return{configuration:t}},bindListingView:function(t){var a=this;e.ui.footable(t.find(".footable")),e.ui.tooltips(t),t.find(".new-account").on("click",function(){a.renderEditConfiguration()}),t.find(".update-account").on("click",function(){var t=n(this).parents("tr"),e=t.data("id");a.renderEditConfiguration(e)}),t.find(".delete-account").on("click",function(){var t=n(this).parents("tr"),o=t.data("id"),s=t.data("name");console.log(t,o,s),e.ui.confirm(a.getTemplate({name:"!"+a.i18n.active().integrationAWS.confirmDelete,data:{accountName:s}}),function(){a.deleteAWSAccount(o,function(){i.success(a.getTemplate({name:"!"+a.i18n.active().integrationAWS.successDelete,data:{accountName:s}})),a.renderListAccounts()})})})},formatAWSData:function(t){var n={awsAccounts:[]};return a.each(t.attachments,function(t,a){"s3"===t.handler&&(t.extra={uuid:a},n.awsAccounts.push(t))}),n},initStorage:function(t){var n=this;n.callApi({resource:"storage.add",data:{accountId:n.accountId,data:{attachments:{}}},success:function(n){t&&t(n.data)}})},saveAWSConfiguration:function(t,a,i){var o,s=this;t&&s.appFlags.appData.storage.attachments.hasOwnProperty(t)?(o=t,s.appFlags.appData.storage.attachments[o]=n.extend(!0,{},s.appFlags.appData.storage.attachments[t],a)):(o=e.util.guid(),s.appFlags.appData.storage.attachments[o]=n.extend(!0,{},{handler:"s3"},a)),s.updateAWSAccounts(s.appFlags.appData.storage,function(t){i&&i(s.appFlags.appData.storage.attachments[o])})},getConfigurationData:function(t,n){var a,e=this;e.appFlags.appData.storage.attachments.hasOwnProperty(t)&&(a=e.appFlags.appData.storage.attachments[t]),n&&n(a)},updateAWSAccounts:function(t,n){var a=this;a.callApi({resource:"storage.update",data:{accountId:a.accountId,data:t},success:function(t){n&&n(t.data)}})},patchAWSAccounts:function(t,n){var a=this;a.callApi({resource:"storage.patch",data:{accountId:a.accountId,data:t},success:function(t){n&&n(t.data)}})},deleteAWSAccount:function(t,a){var e=this;e.getAWSAccounts(function(i){var o=n.extend(!0,{},i.attachments[t]);delete i.attachments[t],e.updateAWSAccounts(i,function(t){a&&a(o)})})},getAWSAccounts:function(t){var n=this,a=function(a){n.appFlags.appData.storage=a,t&&t(a)};n.callApi({resource:"storage.get",data:{accountId:n.accountId,generateError:!1},success:function(t){a(t.data)},error:function(t,e,i){404===e.status?n.initStorage(function(t){a(t)}):i(t)}})}}}),this.monster=this.monster||{},this.monster.cache=this.monster.cache||{},this.monster.cache.templates=this.monster.cache.templates||{},this.monster.cache.templates["integration-aws"]=this.monster.cache.templates["integration-aws"]||{},this.monster.cache.templates["integration-aws"]._main=this.monster.cache.templates["integration-aws"]._main||{},this.monster.cache.templates["integration-aws"]._main["edit-configuration"]=Handlebars.template({1:function(t,n,a,e,i){return" edition-mode"},3:function(t,n,a,e,i){return" creation-mode"},compiler:[7,">= 4.0.0"],main:function(t,n,a,e,i){var o,s=t.lambda,l=t.escapeExpression;return'<div class="edit-configuration-wrapper'+(null!=(o=a.if.call(null!=n?n:t.nullContext||{},null!=(o=null!=n?n.configuration:n)?o.name:o,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.program(3,i,0),data:i}))?o:"")+'">\n\t<form class="form form-horizontal form-inline" id="configuration_form">\n\t\t<div class="header-form">\n\t\t\t<svg class="logo-header"><use xlink:href="#aws--color" /></svg>\n\t\t\t<div class="text-creation">\n\t\t\t\t<div class="title">'+l(s((o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.title,n))+'</div>\n\t\t\t</div>\n\n\t\t\t<div class="text-edition">\n\t\t\t\t<div class="title">\n\t\t\t\t\t<span class="configuration-name">'+l(s(null!=(o=null!=n?n.configuration:n)?o.name:o,n))+'</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="subtitle">\n\t\t\t\t\t<span>'+l(s((o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.subTitle,n))+'</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\n\n\t\t<div class="content">\n\t\t\t<div class="content-data clearfix">\n\t\t\t\t<div class="content-block">\n\t\t\t\t\t<div class="content-title">'+l(s((o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.details,n))+'</div>\n\t\t\t\t\t<div class="content-data">\n\t\t\t\t\t\t<div class="control-group">\n\t\t\t\t\t\t\t<label class="control-label">'+l(s((o=(o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.name)&&o.label,n))+'</label>\n\t\t\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t\t\t<input required type="text" name="name" value="'+l(s(null!=(o=null!=n?n.configuration:n)?o.name:o,n))+'">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="control-group">\n\t\t\t\t\t\t\t<label class="control-label">'+l(s((o=(o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.accessKeyId)&&o.label,n))+'</label>\n\t\t\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t\t\t<input required id="settings_key" type="password" name="settings.key" value="'+l(s(null!=(o=null!=(o=null!=n?n.configuration:n)?o.settings:o)?o.key:o,n))+'">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="control-group">\n\t\t\t\t\t\t\t<label class="control-label">'+l(s((o=(o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.secretKey)&&o.label,n))+'</label>\n\t\t\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t\t\t<input required id="settings_secret" type="password" name="settings.secret" value="'+l(s(null!=(o=null!=(o=null!=n?n.configuration:n)?o.settings:o)?o.secret:o,n))+'">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="control-group">\n\t\t\t\t\t\t\t<label class="control-label">'+l(s((o=(o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.bucket)&&o.label,n))+'</label>\n\t\t\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t\t\t<input required type="text" name="settings.bucket" value="'+l(s(null!=(o=null!=(o=null!=n?n.configuration:n)?o.settings:o)?o.bucket:o,n))+'">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="control-group">\n\t\t\t\t\t\t\t<label class="control-label">'+l(s((o=(o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.host)&&o.label,n))+'</label>\n\t\t\t\t\t\t\t<div class="controls">\n\t\t\t\t\t\t\t\t<input type="text" name="settings.host" value="'+l(s(null!=(o=null!=(o=null!=n?n.configuration:n)?o.settings:o)?o.host:o,n))+'">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="content-help clearfix">\n\t\t\t\t<i class="fa fa-question-circle"></i>\n\t\t\t\t<span class="content-help-text">'+l(s((o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.edition)&&o.helpBeforeLink,n))+'</span>\n\t\t\t\t(<a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/Introduction.html" target="_blank">http://docs.aws.amazon.com/AmazonS3/latest/dev/Introduction.html</a>)\n\t\t\t</div>\n\n\t\t\t<div class="content-actions clearfix">\n\t\t\t\t<div class="pull-right">\n\t\t\t\t\t<button class="monster-button-cancel" id="cancel">'+l(s(null!=(o=null!=n?n.i18n:n)?o.cancel:o,n))+'</button>\n\t\t\t\t\t<button class="monster-button-success" id="save">'+l(s(null!=(o=null!=n?n.i18n:n)?o.saveChanges:o,n))+"</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</form>\n</div>"},useData:!0}),this.monster.cache.templates["integration-aws"]._main.layout=Handlebars.template({1:function(t,n,a,e,i){var o,s=t.lambda,l=t.escapeExpression;return'\t\t<div class="list-accounts-wrapper">\n\t\t\t<div class="list-title">'+l(s(null!=(o=null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.table:o)?o.title:o,n))+'</div>\n\t\t\t<div class="list-accounts">\n\t\t\t\t<div class="monster-table-wrapper">\n\t\t\t\t\t<div class="monster-table-header">\n\t\t\t\t\t\t<button class="monster-button-primary new-account">\n\t\t\t\t\t\t\t'+l(s(null!=(o=null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.table:o)?o.newAccount:o,n))+'\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<table class="monster-table footable">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th>'+l(s(null!=(o=null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.table:o)?o.accountName:o,n))+'</th>\n\t\t\t\t\t\t\t\t<th data-breakpoints="xs" data-type="html">'+l(s(null!=(o=null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.table:o)?o.actions:o,n))+"</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n"+(null!=(o=a.each.call(null!=n?n:t.nullContext||{},null!=n?n.awsAccounts:n,{name:"each",hash:{},fn:t.program(2,i,0),inverse:t.noop,data:i}))?o:"")+"\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n"},2:function(t,n,a,e,i){var o,s,l=t.lambda,c=t.escapeExpression,r=null!=n?n:t.nullContext||{},u=a.helperMissing;return'\t\t\t\t\t\t\t\t<tr data-id="'+c(l(null!=(o=null!=n?n.extra:n)?o.uuid:o,n))+'" data-name="'+c((s=null!=(s=a.name||(null!=n?n.name:n))?s:u,"function"==typeof s?s.call(r,{name:"name",hash:{},data:i}):s))+'">\n\t\t\t\t\t\t\t\t\t<td>'+c((s=null!=(s=a.name||(null!=n?n.name:n))?s:u,"function"==typeof s?s.call(r,{name:"name",hash:{},data:i}):s))+'</td>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<i class="action-link update-account fa fa-cog" data-toggle="tooltip" data-placement="top" data-original-title="'+c(l((o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.table)&&o.editTooltip,n))+'"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="action-link delete-account fa fa-trash-o" data-toggle="tooltip" data-placement="top" data-original-title="'+c(l((o=(o=(o=(o=i&&i.root)&&o.i18n)&&o.integrationAWS)&&o.table)&&o.deleteTooltip,n))+'"></i>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n'},4:function(t,n,a,e,i){var o;return'\t\t<div class="no-accounts-wrapper new-account">\n\t\t\t<i class="fa fa-plus-circle"></i>\n\t\t\t<span class="no-accounts-text">'+t.escapeExpression(t.lambda(null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.noAccount:o,n))+"</span>\n\t\t</div>\n"},compiler:[7,">= 4.0.0"],main:function(t,n,a,e,i){var o,s=t.lambda,l=t.escapeExpression;return'<div id="integration-aws_listing_wrapper">\n\t<div class="title-bar-wrapper">\n\t\t<svg class="title-logo"><use xlink:href="#aws--color" /></svg>\n\t\t<div class="title-text">'+l(s(null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.title:o,n))+'</div>\n\t\t<div class="title-subtext">'+l(s(null!=(o=null!=(o=null!=n?n.i18n:n)?o.integrationAWS:o)?o.description:o,n))+"</div>\n\t</div>\n\n\n"+(null!=(o=a.if.call(null!=n?n:t.nullContext||{},null!=(o=null!=n?n.awsAccounts:n)?o.length:o,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.program(4,i,0),data:i}))?o:"")+"</div>\n"},useData:!0});