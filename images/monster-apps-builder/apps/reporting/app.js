define("apps/reporting/app",["require","jquery","lodash","monster","toastr"],function(t){var n=t("jquery"),e=(t("lodash"),t("monster"));t("toastr");return{css:["app"],i18n:{"en-US":{customCss:!1}},requests:{"reporting.reseller.post":{url:"",verb:"POST",generateError:!1}},load:function(t){var n=this;n.initApp(function(){t&&t(n)})},initApp:function(t){var n=this;e.pub("auth.initApp",{app:n,callback:t})},render:function(t){var l=this,t=t||n("#monster_content");l.listAccounts(function(r){var a=n(e.template(l,"layout",{accounts:r,accountId:l.accountId}));l.bindUIEvents(a),t.empty().append(a)})},bindUIEvents:function(t){var n=this;t.find("#clearEvents").on("click",function(){t.find(".table tbody tr:not(.no-events)").remove()}),t.find("#runReport").on("click",function(){n.requestReport("1","2016","d@d-man.org",function(t){alert(t)})}),t.find(".select-all").on("click",function(){t.find('.list-accounts input[type="checkbox"]').prop("checked",!0)}),t.find(".unselect-all").on("click",function(){t.find('.list-accounts input[type="checkbox"]').prop("checked",!1)})},formatEvent:function(t){var n=this,e=t;return e.extra={},e.extra.to=t.To.substr(0,t.To.indexOf("@")),e.extra.friendlyEvent=n.i18n.active().reseller_reporting.events[t["Event-Name"]],e.extra.classEvent="CHANNEL_CREATE"===t["Event-Name"]?"info":"CHANNEL_ANSWER"===t["Event-Name"]?"success":"error","Custom-Channel-Vars"in t&&"Authorizing-Type"in t["Custom-Channel-Vars"]&&"device"===t["Custom-Channel-Vars"]["Authorizing-Type"]&&(e.extra.deviceId=t["Custom-Channel-Vars"]["Authorizing-ID"]),e},listAccounts:function(t){var n=this;n.callApi({resource:"account.listDescendants",apiUrl:e.config.api.default,data:{accountId:n.accountId,filters:{paginate:!1}},success:function(n){t(n.data)},error:function(t){alert("Something is broken.")}})},validateEmail:function(t){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},requestReport:function(t,n,l,r){var a=this,s=e.ui.getFormData("form_reseller_reporting");s.accountId=a.accountId,a.validateEmail(s.email_address)?e.request({resource:"reporting.reseller.post",data:{data:s},success:function(t,n){t.data.error,r&&r(t.data.message)},error:function(){r&&r("We had trouble communicating with the server")}}):alert("Invalid email address")}}}),this.monster=this.monster||{},this.monster.cache=this.monster.cache||{},this.monster.cache.templates=this.monster.cache.templates||{},this.monster.cache.templates.reporting=this.monster.cache.templates.reporting||{},this.monster.cache.templates.reporting._main=this.monster.cache.templates.reporting._main||{},this.monster.cache.templates.reporting._main.event=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(t,n,e,l,r){var a,s,i=t.lambda,o=t.escapeExpression,c=null!=n?n:t.nullContext||{},u=e.helperMissing;return'<tr class="event-item '+o(i(null!=(a=null!=n?n.extra:n)?a.classEvent:a,n))+'" data-deviceid="'+o(i(null!=(a=null!=n?n.extra:n)?a.deviceId:a,n))+'">\n\t<td>'+o(i(null!=(a=null!=n?n.extra:n)?a.friendlyEvent:a,n))+"</td>\n\t<td>"+o((s=null!=(s=e["Caller-ID-Name"]||(null!=n?n["Caller-ID-Name"]:n))?s:u,"function"==typeof s?s.call(c,{name:"Caller-ID-Name",hash:{},data:r}):s))+"</td>\n\t<td>"+o(i(null!=(a=null!=n?n.extra:n)?a.to:a,n))+"</td>\n\t<td>"+o((e.toFriendlyDate||n&&n.toFriendlyDate||u).call(c,null!=n?n.Timestamp:n,{name:"toFriendlyDate",hash:{},data:r}))+"</td>\n</tr>"},useData:!0}),this.monster.cache.templates.reporting._main.layout=Handlebars.template({1:function(t,n,e,l,r){var a;return"\t\t\t\t\t\t\t\t<li>\n"+(null!=(a=(e.monsterCheckbox||n&&n.monsterCheckbox||e.helperMissing).call(null!=n?n:t.nullContext||{},null!=n?n.name:n,{name:"monsterCheckbox",hash:{},fn:t.program(2,r,0),inverse:t.noop,data:r}))?a:"")+"\t\t\t\t\t\t\t\t</li>\n"},2:function(t,n,e,l,r){var a;return'\t\t\t\t\t\t\t\t\t\t<input type="checkbox" checked  name="account_list[]" value="'+t.escapeExpression((a=null!=(a=e.id||(null!=n?n.id:n))?a:e.helperMissing,"function"==typeof a?a.call(null!=n?n:t.nullContext||{},{name:"id",hash:{},data:r}):a))+'">\n'},4:function(t,n,e,l,r){return"\t\t\t\t\t\t\t\t\t<option>"+t.escapeExpression(t.lambda(n,n))+"</option>\n"},compiler:[7,">= 4.0.0"],main:function(t,n,e,l,r){var a,s,i=t.lambda,o=t.escapeExpression,c=null!=n?n:t.nullContext||{},u=e.helperMissing;return'<div id="reseller_reporting_wrapper">\n\t\t<form id="form_reseller_reporting">\n\t<div class="reseller-reporting-content row-fluid">\n\t\t<div class="span8 offset2">\n\t\t\t<div class="span12">\n\t\t\t\t<div class="title-container">\n\t\t\t\t\t<h1>'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.welcome:a,n))+"</h1>\n\t\t\t\t\t<small>Account ID: "+o((s=null!=(s=e.accountId||(null!=n?n.accountId:n))?s:u,"function"==typeof s?s.call(c,{name:"accountId",hash:{},data:r}):s))+'</small><br/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="row-fluid">\n\t\t\t\t\t<div class="span6">\n\t\t\t\t\t\t<h4>'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.listAccounts:a,n))+':</h4>\n\t\t\t\t\t\t<ul class="list-accounts">\n\t\t\t\t\t\t\t<div class="quick-links">\n\t\t\t\t\t\t\t\t<a class="monster-link blue select-all" href="javascript:void(0);">'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.selectAll:a,n))+'</a>\n\t\t\t\t\t\t\t\t<a class="monster-link blue unselect-all" href="javascript:void(0);">'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.unselectAll:a,n))+"</a>\n\t\t\t\t\t\t\t</div>\n"+(null!=(a=e.each.call(c,null!=n?n.accounts:n,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r}))?a:"")+'\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="span6">\n\t\t\t\t\t\t<h4>'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.reportOptions:a,n))+"</h4>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<span>"+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.reportPeriod:a,n))+': </span>\n\t\t\t\t\t\t\t<select name="month" class="month">\n'+(null!=(a=(e.times||n&&n.times||u).call(c,12,{name:"times",hash:{},fn:t.program(4,r,0),inverse:t.noop,data:r}))?a:"")+'\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t/\n\t\t\t\t\t\t\t<select name="year" class="year">\n\t\t\t\t\t\t\t\t\t<option>2015</option>\n\t\t\t\t\t\t\t\t\t<option>2016</option>\n\t\t\t\t\t\t\t\t\t<option selected>2017</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="middle-div">\n\t\t\t\t\t\t\t\x3c!-- <div><input type="checkbox" checked  name="include_reseller_cost"> '+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.resellerCost:a,n))+' <span class="fa fa-info-circle"></span></div>\n\t\t\t\t\t\t\t<div><input type="checkbox" checked disabled name="include_customer_cost"> '+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.customerCost:a,n))+' <span alt="Test" class="fa fa-info-circle"></span></div> --\x3e\n\t\t\t\t\t\t\t<div>'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.deliverAddress:a,n))+': <input type="text" name="email_address"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button class="monster-button monster-button-primary" type="button" id="runReport">'+o(i(null!=(a=null!=(a=null!=n?n.i18n:n)?a.reseller_reporting:a)?a.runReport:a,n))+"</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t</form>\n</div>\n"},useData:!0});